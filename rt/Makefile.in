CC = gcc
LD = gcc

BIN = amprt

OBJ = $(OBJX) \
      \
      src/main.o \
      \
      src/argv.o \
      src/comm.o \
      src/exec.o \

INC = $(INCX) \
      \
      src/common.h \
      src/debug.h \
      src/defs.h \
      \
      src/argv.h \
      src/comm.h \
      src/exec.h \
     
# build rules

all: $(BIN)

$(BIN): $(OBJ)
	$(LD) -o $@ $^ $(LDFLAGS)

%.o: %.c Makefile $(INC)
	$(CC) -c -o $@ $< $(CFLAGS)

Makefile: configure Makefile.in $(wildcard config.args)
	./configure $(ARGS)

# clean rules

clean:
	rm -rf src/*.o $(BIN)

# install rules

install: all
	install --mode 0755 -D $(BIN) $(BINDIR)/$(BIN)

# phony

.PHONY: all install clean run

# extra includes

-include Makefile.user Makefile.proj
